"""
–ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª—É–Ω–Ω—ã–º –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–º
"""
from datetime import datetime
import requests


def get_lunar_info() -> dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ª—É–Ω–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
    """
    today = datetime.now()
    
    # –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª—É–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    # –ü–æ–∫–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
    lunar_info = {
        "day": f"–°–µ–≥–æ–¥–Ω—è {today.strftime('%d.%m.%Y')}",
        "phase": get_lunar_phase(today),
        "sign": "–°—Ç—Ä–µ–ª–µ—Ü",
        "recommendation": get_lunar_recommendation(today)
    }
    
    return lunar_info


def get_lunar_phase(date: datetime) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–∞–∑—É –ª—É–Ω—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ—á–Ω—ã–µ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    """
    # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ñ–∞–∑—ã –ª—É–Ω—ã
    # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω—ã —Ç–æ—á–Ω—ã–µ –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
    
    phases = [
        "üåë –ù–æ–≤–æ–ª—É–Ω–∏–µ - –≤—Ä–µ–º—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π",
        "üåí –†–∞—Å—Ç—É—â–∞—è –ª—É–Ω–∞ - –ø–µ—Ä–∏–æ–¥ —Ä–æ—Å—Ç–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏—è",
        "üåì –ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å - –∞–∫—Ç–∏–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ",
        "üåî –ü–æ–∫—Ä—ã–≤–∞—é—â–∞—è –ª—É–Ω–∞ - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—é",
        "üåï –ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ - –ø–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —ç–º–æ—Ü–∏–π",
        "üåñ –£–±—ã–≤–∞—é—â–∞—è –ª—É–Ω–∞ - –≤—Ä–µ–º—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ª",
        "üåó –ü–æ—Å–ª–µ–¥–Ω—è—è —á–µ—Ç–≤–µ—Ä—Ç—å - –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤",
        "üåò –ë–∞–ª—å–∑–∞–º–∏—á–µ—Å–∫–∞—è –ª—É–Ω–∞ - –æ—Ç–¥—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞"
    ]
    
    # –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–Ω–µ–π –º–µ—Å—è—Ü–∞
    day_of_month = date.day
    phase_index = (day_of_month % 28) // 4
    
    return phases[min(phase_index, len(phases) - 1)]


def get_lunar_recommendation(date: datetime) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ª—É–Ω–Ω–æ–≥–æ –¥–Ω—è
    """
    day_of_month = date.day
    
    if day_of_month <= 7:
        return ("üå± –†–∞—Å—Ç—É—â–∞—è –ª—É–Ω–∞ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π. "
                "–ó–∞–ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–µ–ª–∞, –Ω–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã. "
                "–≠–Ω–µ—Ä–≥–∏—è –ª—É–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–≤–æ–π —Ä–æ—Å—Ç –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ.")
    elif day_of_month <= 14:
        return ("‚ö° –ü–µ—Ä–≤–∞—è —á–µ—Ç–≤–µ—Ä—Ç—å - –≤—Ä–µ–º—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π. "
                "–ó–∞–≤–µ—Ä—à–∏—Ç–µ –Ω–∞—á–∞—Ç–æ–µ, –ø—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É. "
                "–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç–Ω–µ—Ä–≥–∏—é –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π.")
    elif day_of_month <= 21:
        return ("üåï –ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ - –ø–∏–∫ —ç–Ω–µ—Ä–≥–∏–∏. "
                "–£–¥–µ–ª–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ —ç–º–æ—Ü–∏—è–º, –∑–∞–≤–µ—Ä—à–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–µ–ª–∞. "
                "–û—Ç–ª–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –º–µ–¥–∏—Ç–∞—Ü–∏–π –∏ –¥—É—Ö–æ–≤–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫.")
    else:
        return ("üåô –£–±—ã–≤–∞—é—â–∞—è –ª—É–Ω–∞ - –≤—Ä–µ–º—è –ø–æ–¥–≤–µ–¥–µ–Ω–∏—è –∏—Ç–æ–≥–æ–≤. "
                "–ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç—ã, –∏–∑–±–∞–≤–ª—è–π—Ç–µ—Å—å –æ—Ç –Ω–µ–Ω—É–∂–Ω–æ–≥–æ. "
                "–û—Ç–¥—ã—Ö–∞–π—Ç–µ –∏ –Ω–∞–∫–∞–ø–ª–∏–≤–∞–π—Ç–µ —Å–∏–ª—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞.")


def get_moon_sign(date: datetime) -> str:
    """
    –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–Ω–∞–∫ –ª—É–Ω—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
    """
    signs = [
        "–û–≤–µ–Ω", "–¢–µ–ª–µ—Ü", "–ë–ª–∏–∑–Ω–µ—Ü—ã", "–†–∞–∫",
        "–õ–µ–≤", "–î–µ–≤–∞", "–í–µ—Å—ã", "–°–∫–æ—Ä–ø–∏–æ–Ω",
        "–°—Ç—Ä–µ–ª–µ—Ü", "–ö–æ–∑–µ—Ä–æ–≥", "–í–æ–¥–æ–ª–µ–π", "–†—ã–±—ã"
    ]
    
    # –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç
    day_of_year = date.timetuple().tm_yday
    sign_index = (day_of_year % 365) // 30
    
    return signs[min(sign_index, len(signs) - 1)]

